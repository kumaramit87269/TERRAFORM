resource "aws_instance" "web" {
  ami = var.amis[var.aws_region]
  instance_type = "t3.micro"

  subnet_id  = element(aws_subnet.cluster-vpc-subnets-public.*.id, count.index)
  associate_public_ip_address  = true
  key_name = "key-01"
  count = 2
  vpc_security_group_ids = [aws_security_group.bastion-sg.id]

  tags = {
    Name = "MY_Terrafom_Instance-bastion-${count.index}"
  }
}

resource "aws_instance" "slave" {
  ami = var.amis[var.aws_region]
  instance_type = "t3.micro"

  subnet_id  = element(aws_subnet.cluster-vpc-subnets-public.*.id, count.index)
  associate_public_ip_address  = false
  key_name = "key-01"
  count = 2
  vpc_security_group_ids = [aws_security_group.bastion-sg.id]

  tags = {
    Name = "MY_Terrafom_Instance-private-${count.index}"
  }
  lifecycle {
        ignore_changes = [tags,instance_type]

}
}